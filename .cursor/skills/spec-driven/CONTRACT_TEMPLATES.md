# 契约模板补充字段

本文档定义不同工作类型在通用契约结构基础上的补充字段。

通用结构见 `spec_driven.mdc` 的 `<contract_template>`，包含：CHANGELOG、目标、范围、验收标准、风险与约束、代码引用。

---

## FEATURE

新功能或现有功能增强。

补充字段：

**待澄清列表**
未确认的问题，在用户确认前标记

**需求正文**
使用 MoSCoW 优先级标记：
- MUST 必须实现
- SHOULD 应该实现
- COULD 可以实现
- WON'T 明确不做

需求 ID 格式为 `REQ-001`，每条 MUST 级别需求必须有稳定 ID，ID 不复用。

---

## BUGFIX

修复已有行为与预期不符的问题。

补充字段：

**问题描述**
- 现象：用户可观察到的错误行为
- 复现条件：触发 Bug 的前置条件和步骤
- 影响范围：受影响的功能、用户、数据

**根因分析**
- 定位：问题代码位置
- 原因：为什么会出现这个问题

**修复方案**
- 修复动作：最小改动描述
- 回归风险：可能影响的其他功能

---

## REFACTOR

不改变外部行为的内部结构调整。

补充字段：

**现状问题**
- 当前结构的具体问题
- 维护或扩展的痛点

**不变性约束**
- 外部接口不变
- 输入输出行为不变
- 性能不劣化

---

## CHORE

依赖更新、CI/CD 配置、工具链调整。

补充字段：

**变更内容**
- 具体改动项（依赖版本、配置项、脚本等）
- 变更原因

**影响范围**
- 受影响的环境（开发、测试、生产）
- 受影响的流程（构建、部署、测试）

**回滚方案**
如何恢复到变更前状态

---

## PERF

性能优化，有明确指标。

补充字段：

**优化目标**
- 当前指标：具体数值和测量方式
- 目标指标：期望达到的数值
- 测量环境：硬件、数据规模、并发量

**瓶颈分析**
- 定位：性能瓶颈位置
- 原因：为什么慢

**优化方案**
- 优化手段：具体技术方案
- 预期收益：预估提升幅度
- 潜在代价：内存、复杂度、可维护性

---

## MIGRATION

数据迁移或技术栈迁移。

补充字段：

**迁移范围**
- 涉及的数据或系统
- 数据量或影响用户数

**迁移方案**
- 迁移步骤
- 数据映射关系
- 兼容期策略

**风险控制**
- 回滚方案：如何恢复
- 灰度策略：分批次、分用户
- 数据校验：如何验证迁移正确性

**时间窗口**
迁移执行的时间要求

---

## DEPRECATION

废弃功能，需要迁移路径。

补充字段：

**废弃目标**
- 废弃什么：功能、接口、字段
- 废弃原因：为什么废弃

**影响分析**
- 受影响的调用方
- 受影响的数据

**迁移路径**
- 替代方案：用什么替代
- 迁移指南：调用方如何迁移

**时间计划**
- 告警期：开始提示废弃的时间
- 兼容期：保持可用但告警的时间
- 移除期：完全移除的时间
